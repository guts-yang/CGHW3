# 3D模型渲染器

这是一个基于Windows GDI+的3D模型渲染器，能够渲染带有内部通孔的立方体框架，并提供完整的交互式操作功能。项目集成了欧拉操作创建实体模型的接口。

## 项目概述

该项目实现了一个简单的3D线框模型渲染系统，能够将使用欧拉操作创建的实体模型转换为线框表示，并在窗口中进行渲染。用户可以通过鼠标和键盘进行交互，实现模型的旋转、平移和缩放等操作。
<img width="979" height="700" alt="image" src="https://github.com/user-attachments/assets/b290409d-0137-4747-b900-5504841e8207" />

## 功能特点

- **欧拉操作支持**：集成了欧拉操作接口，用于创建和修改实体模型
- **3D线框渲染**：使用GDI+绘制3D模型的线框表示
- **内部通孔模型**：支持渲染带有内部长方体通孔的立方体框架
- **交互操作**：
  - 左键拖动：旋转模型
  - 右键拖动：平移模型
  - 滚轮操作：缩放模型
  - ESC键：退出程序
- **双缓冲渲染**：避免绘制过程中的闪烁问题
- **操作提示**：界面和控制台显示操作说明

## 项目结构

```
d:\coding\CG\CGHW3\
├── EulerOperations.cpp    # 欧拉操作实现文件
├── EulerOperations.h      # 欧拉操作头文件
├── SolidModel.h           # 实体模型定义
├── main.cpp               # 主程序，包含渲染和交互逻辑
├── DLL/                   # 动态链接库目录
│   ├── opencv_videoio_ffmpeg4120_64.dll
│   ├── opencv_world4120.dll
│   └── opencv_world4120d.dll
└── README.md              # 项目说明文件（本文档）
```

## 核心功能模块

### 1. 模型表示与转换

- **数据结构**：使用`Point3D`和`LineSegment3D`表示3D点和线段
- **模型转换**：`modelToLineSegments`函数将欧拉操作创建的实体模型转换为可渲染的线段集合
- **复合模型创建**：在`WinMain`函数中实现了带有内部通孔的立方体模型
  - 外部立方体框架：完整的立方体12条边
  - 内部长方体通孔：尺寸为外部立方体的一半，两端与外部立方体表面相切
  - 顶点定义：使用数组定义所有顶点坐标，包括外部立方体和内部通孔的顶点
  - 边连接关系：通过顶点索引对定义所有边的连接关系

### 2. 3D-2D投影系统

- **投影函数**：`projectPoint`函数实现3D坐标到2D屏幕坐标的转换
- **变换操作**：支持旋转变换（绕X轴和Y轴）、缩放变换和平移变换
- **中心变换**：所有旋转变换围绕模型中心点进行，提供更自然的交互体验

### 3. 渲染系统

- **GDI+绘图**：使用Windows GDI+库进行图形渲染，支持高质量的2D绘图
- **双缓冲机制**：通过内存DC和位图实现双缓冲，避免渲染闪烁，提供流畅的交互体验
- **线段绘制**：`drawLine`函数处理线段的裁剪和绘制，确保线段在窗口边界内正确显示
- **用户界面**：显示模型和操作提示文本，提供清晰的用户交互指导
- **复合模型渲染**：同时渲染外部框架和内部通孔，通过线框形式展示模型的立体结构

### 4. 交互系统

- **鼠标处理**：处理左键旋转、右键平移和滚轮缩放操作
- **键盘控制**：支持ESC键退出程序
- **窗口管理**：处理窗口创建、大小调整和销毁等事件

## 技术实现细节

### 3D变换原理

3D点到2D屏幕的转换过程包括以下步骤：

1. **中心偏移**：将点坐标相对于模型中心点偏移
2. **旋转变换**：应用绕X轴和Y轴的旋转变换矩阵
   - 绕X轴旋转：`y' = y*cos(θ) - z*sin(θ)`, `z' = y*sin(θ) + z*cos(θ)`
   - 绕Y轴旋转：`x' = x*cos(φ) + z*sin(φ)`, `z' = -x*sin(φ) + z*cos(φ)`
3. **缩放变换**：应用缩放因子，控制模型的显示大小
4. **屏幕映射**：将3D坐标映射到屏幕坐标系，注意Y轴方向的反转（计算机图形学标准）

### 内部通孔实现技术

内部长方体通孔的实现采用了以下技术策略：

1. **顶点坐标精确计算**：
   - 外部立方体顶点坐标范围：x,y,z ∈ [-1,1]
   - 内部长方体顶点坐标：x,y ∈ [-0.5,0.5]，z ∈ [-1,1]
   - 确保内部通孔两端与外部立方体表面完全相切

2. **复合线框渲染**：
   - 同时渲染外部立方体的12条边和内部长方体的12条边
   - 总共渲染24条边，组成完整的带通孔立方体框架
   - 线框渲染方式能够清晰展示内部结构

3. **三维空间关系处理**：
   - 通过精确的坐标定义，确保内部长方体完全位于外部立方体内
   - 通孔的尺寸可以通过调整`innerSize`参数灵活控制

### 渲染优化

- **线段裁剪**：只渲染完全在窗口内的线段，提高渲染效率
- **双缓冲技术**：所有绘制操作先在内存中完成，然后一次性复制到屏幕，避免闪烁
- **对象复用**：尽可能复用GDI+对象，如画笔和字体，减少资源创建开销

## 使用方法

### 编译

使用以下命令编译程序（Windows环境）：

```bash
g++ -o hw3_render.exe main.cpp EulerOperations.cpp -I. -lgdiplus -lgdi32
```

### 运行

编译成功后，运行生成的可执行文件：

```bash
./hw3_render.exe
```

程序启动后，将显示一个带有内部通孔的立方体框架模型，并在控制台输出操作说明。

### 交互操作

- **左键拖动**：旋转模型
- **右键拖动**：平移模型
- **滚轮**：缩放模型（向前滚动放大，向后滚动缩小）
- **ESC键**：退出程序

## 系统要求

- **操作系统**：Windows 7/8/10/11
- **编译器**：支持C++11及以上标准的编译器（如MinGW GCC、Visual Studio MSVC等）
- **库依赖**：Windows GDI+和GDI32（Windows系统自带）
- **硬件要求**：支持基本图形渲染的显卡，至少512MB内存

## 注意事项

1. 程序默认创建立方体框架模型进行渲染
2. 欧拉操作部分可能需要根据具体实现进行调整
3. 可以通过修改代码中的模型定义来渲染其他形状
4. 缩放和平移操作有范围限制，防止模型显示异常

## 开发历史

1. 初始设计阶段：确定使用Windows GDI+进行渲染
2. 核心功能实现：开发模型转换、投影和渲染函数
3. 交互系统开发：实现鼠标和键盘事件处理
4. 性能优化：添加双缓冲和裁剪优化
5. 测试与调试：修复渲染和交互相关问题

## 扩展可能性

1. 添加更多模型创建方式
2. 实现更复杂的3D变换（如绕Z轴旋转）
3. 添加光照效果
4. 支持导入/导出模型文件
5. 实现面填充渲染模式
6. 支持多线程渲染优化#   C G H W 3 
 
 
